import"./CzmBWQzT.js";class u{static roundedClamp(t,e,s){return u.clamp(Math.round(t),e,s)}static clamp(t,e,s){return Math.max(Math.min(t,s),e)}static round(t,e){return Math.round(t*10**e)/10**e}}class _{r;g;b;a;hex;constructor(...t){if(typeof t[0]=="string"){this.hex=t[0];const{r:e,g:s,b:i,a:n}=_.hexToRgba(this.hex);this.r=e,this.g=s,this.b=i,this.a=n}else{const[e=0,s=0,i=0,n=1]=t;this.r=e,this.g=u.clamp(s,0,255),this.b=u.clamp(i,0,255),this.a=u.clamp(n,0,255),this.hex=_.getHex(e,s,i,n)}}static hexToRgba(t){if(t=t.replace(/^#/,""),![3,4,6,8].includes(t.length))throw new Error("Invalid hex color code"+t+". Must be 3, 4, 6, or 8 digits. but was"+t);(t.length===3||t.length===4)&&(t=t.split("").map(h=>h+h).join(""));let e,s,i,n=1;return t.length===6?(e=parseInt(t.slice(0,2),16),s=parseInt(t.slice(2,4),16),i=parseInt(t.slice(4,6),16)):(e=parseInt(t.slice(0,2),16),s=parseInt(t.slice(2,4),16),i=parseInt(t.slice(4,6),16),n=parseInt(t.slice(6,8),16)/255),n=Math.round(n*100)/100,{r:e,g:s,b:i,a:n}}static getHex(t,e,s,i){const n=t.toString(16).padStart(2,"0"),h=e.toString(16).padStart(2,"0"),o=s.toString(16).padStart(2,"0"),a=i?Math.round(i*255).toString(16).padStart(2,"0"):"";return`#${n}${h}${o}${a}`}toString(){return this.a===1?`rgb(${this.r}, ${this.g}, ${this.b})`:`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a.toFixed(2)})`}}var S=(r=>(r[r.LIGHT=0]="LIGHT",r[r.DARK=1]="DARK",r[r.AUTO=2]="AUTO",r))(S||{}),v=(r=>(r.DEFAULT="default",r.HIGHLIGHTED="highlighted",r.SELECTED="selected",r.HOVER="hover",r.ON_BACKGROUND="on-background",r.ON_PRIMARY="on-primary",r.ON_SECONDARY="on-secondary",r.BORDER="border",r))(v||{});const N=(function(){const r="theme";let t=!1,e=!1,s=getComputedStyle(document.documentElement);function i(){if(window.matchMedia){const o=window.matchMedia("(prefers-color-scheme: dark)");if(t=!0,o.matches?document.documentElement.setAttribute(r,"dark"):document.documentElement.setAttribute(r,"light"),e)return;o.addEventListener("change",a=>{if(e=!0,!!t){if(n(),a.matches){document.documentElement.setAttribute(r,"dark");return}document.documentElement.setAttribute(r,"light")}})}else document.documentElement.setAttribute(r,"light")}function n(){s=getComputedStyle(document.documentElement)}function h(){t=!1}return{setThemeType:o=>{switch(s=getComputedStyle(document.documentElement),h(),o){case 0:document.documentElement.setAttribute(r,"light");break;case 1:document.documentElement.setAttribute(r,"dark");break;case 2:i();break}n()},getBgColor(o,a="default"){const d=`--${o}-bg-${a}-color`,l=s.getPropertyValue(d);return l===""&&console.error(d," is not defined."),new _(l)},getFgColor(o,a="default"){const d=`--${o}-fg-${a}-color`,l=s.getPropertyValue(d);return l===""&&console.error(d," is not defined."),new _(l)},getTextColor(o="on-background"){const a=`--text-${o}-color`,d=s.getPropertyValue(a);return d===""&&console.error(a," is not defined."),new _(d)},getColor(o){const a=`--${o}-color`,d=s.getPropertyValue(a);return d===""&&console.error(a,"is not defined."),new _(d)}}})();class c{static unit_x=Object.freeze(new c(1,0));static unit_y=Object.freeze(new c(0,1));static ZERO=Object.freeze(new c(0,0));x;y;constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new c(this.x,this.y)}length_sqrd(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.length_sqrd())}set(t,e){return this.x=t,this.y=e,this}add(t){return new c(this.x+t.x,this.y+t.y)}addXY(t,e){return new c(this.x+t,this.y+e)}add_self(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return new c(this.x-t.x,this.y-t.y)}subXY(t,e){return new c(this.x-t,this.y-e)}sub_self(t){return this.x-=t.x,this.y-=t.y,this}scale(t,e){return e||(e=t),new c(this.x*t,this.y*e)}scale_self(t,e){return this.x*=t,this.y*=t,this}dot(t){return this.x*t.x+this.y*t.y}toString(){return this.x+"i + "+this.y+"j"}}class w{static ZERO=Object.freeze(new w(0,0));width;height;constructor(t,e){this.width=t,this.height=e}scale(t){return new w(this.width*t,this.height*t)}scale_self(t){return this.width*=t,this.height*=t,this}max(){return Math.max(this.width,this.height)}toString(){return this.width+"x"+this.height}set(t,e){this.width=t,this.height=e}copy(){return new w(this.width,this.height)}}class z{constructor(t,e,s){this.scene=t,this.class_name=s,this.ctx=t.ctx,this.id=e,this.color_state=v.DEFAULT}ctx;color_state;pos=new c(0,0);is_color_animating=!1;color=new _("#f00");id;highlight(){this.scene.animator.add(new k(this,this.color,N.getBgColor(this.getName(),v.HIGHLIGHTED))),this.color_state=v.HIGHLIGHTED}getName(){return this.class_name.toLowerCase()}update(t){this.is_color_animating||(this.color=N.getBgColor(this.getName(),this.color_state))}drawPointVec(t,e="green"){const s=Math.sqrt(t.x**2+t.y**2);s>1&&this.drawArrow(100*t.x/s,100*t.y/s,e)}drawArrow(t,e,s="green"){if(t===0&&e===0)return;this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=5,this.ctx.lineCap="round",this.ctx.strokeStyle=s,this.ctx.moveTo(this.pos.x,this.pos.y);const i=this.pos.add(new c(t,e));this.ctx.lineTo(i.x,i.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}drawCircle(t,e,s,i,n=!1,h,o=1){if(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e,s,t,0,2*Math.PI),this.ctx.fillStyle=i,n){let a=this.ctx.strokeStyle;this.ctx.lineWidth=o,this.ctx.strokeStyle=h,this.ctx.strokeStyle=a,this.ctx.stroke()}this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()}reset(){console.error("Reset not implemented for",this.constructor.name)}drawLine(t,e,s,i,n,h){this.ctx.save(),this.ctx.strokeStyle=h,this.ctx.lineWidth=n,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(s,i),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}drawText(t,e,s,i,n=1){this.ctx.save(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=`${n}em Arial`,this.ctx.fillStyle=i,this.ctx.fillText(t,e,s),this.ctx.restore()}drawRect(t,e,s,i,n="#000",h,o=0,a){this.ctx.save(),this.ctx.fillStyle=n,o>0&&(this.ctx.strokeStyle=h),this.ctx.beginPath(),this.ctx.roundRect(300,5,200,100,a),this.ctx.closePath(),this.ctx.restore()}}function b(r,t,e,s){return r===t?t:r+(t-r)*s(e)}class A{static linear(t){return t}static easeInSin(t){return 1-Math.cos(t*Math.PI/2)}static easeOutSin(t){return Math.sin(t*Math.PI/2)}static easeInOutSin(t){return(1-Math.cos(t*Math.PI))/2}static easeInCubic(t){return t**3}static easeOutCubic(t){return 1-(1-t)**3}static easeInOutCubic(t){return t<.5?4*t**3:1-(1-t)**3}static easeInQuad(t){return t*t}static easeOutQuad(t){return 1-(1-t)**2}static easeInOutQuad(t){return t<.5?2*t**2:1-(1-t)**2}}class O{total_duration_ms;duration_passed_ms;drawable;easing;constructor(t,e,s){this.total_duration_ms=e,this.duration_passed_ms=0,this.easing=s,this.drawable=t}getId(){return this.drawable?this.constructor.name+this.drawable.id:this.constructor.name}}class k extends O{from;to;constructor(t,e,s,i=250,n=A.easeInSin){super(t,i,n),this.from=e,this.to=s,this.drawable.is_color_animating=!0}finalize(){this.setNormalizedTime(1),this.drawable.is_color_animating=!1,this.drawable.color=this.to,this.interrupt()}interrupt(){this.drawable.is_color_animating=!1}setNormalizedTime(t){const e=u.roundedClamp(b(this.from.r,this.to.r,t,this.easing),0,255),s=u.roundedClamp(b(this.from.g,this.to.g,t,this.easing),0,255),i=u.roundedClamp(b(this.from.b,this.to.b,t,this.easing),0,255),n=u.roundedClamp(b(this.from.a,this.to.a,t,this.easing),0,255);this.drawable.color=new _(e,s,i,n)}}class D extends O{constructor(t,e,s,i=250,n=A.easeInSin){super(null,i,n),this.callback=t,this.from=e,this.to=s}finalize(){this.setNormalizedTime(1)}interrupt(){}setNormalizedTime(t){this.callback(b(this.from,this.to,t,this.easing),t===1)}}class B{animations_map=new Map;add(t){const e=t.getId();this.animations_map.has(e)&&this.animations_map.get(e)?.interrupt(),this.animations_map.set(e,t)}step(t){for(const[e,s]of this.animations_map){if(s.duration_passed_ms+=t,s.duration_passed_ms>s.total_duration_ms){s.duration_passed_ms=s.total_duration_ms,s.finalize(),this.animations_map.delete(e);break}const i=s.duration_passed_ms/s.total_duration_ms;s.setNormalizedTime(i)}}}function q(r,t,e){const s=e.center.x-e.half_dimension.width,i=e.center.x+e.half_dimension.width,n=e.center.y-e.half_dimension.height,h=e.center.y+e.half_dimension.height,o=Math.max(s,Math.min(r.x,i)),a=Math.max(n,Math.min(r.y,h)),d=r.x-o,l=r.y-a;return d*d+l*l<=t*t}function $(r,t,e){const s=r.x-e.x,i=r.y-e.y;return s*s+i*i<=t*t}class f{center;half_dimension;constructor(t,e){this.center=t,this.half_dimension=e}static fromRect(t,e,s,i){return new f(new c(t+s/2,e+i/2),new w(s/2,i/2))}update(t,e){this.center=t,this.half_dimension=e}updateRect(t,e,s,i){this.center.set(t+s/2,e+i/2),this.half_dimension.set(s/2,i/2)}containsPoint(t){return Math.abs(t.x-this.center.x)<=this.half_dimension.width&&Math.abs(t.y-this.center.y)<=this.half_dimension.height}intersectsAABB(t){return this.center.x-t.center.x<=this.half_dimension.width+t.half_dimension.width&&this.center.y-t.center.y<=this.half_dimension.height+t.half_dimension.height}toString(){return`${this.center} ${this.half_dimension}`}copy(){return new f(this.center.copy(),this.half_dimension.copy())}}class I{constructor(t,e,s=10){this.id=t,this.point=e,this.mass=s}}class C{static ACCURACY=.9;static FULL_ACCURACY_AREA=new w(100,100);static FULL_ACCURACY_CIRCLE_RADIUS=100;COM;mass=0;regions=[];has_sub_divisions=!1;boundary;node;region_name="";constructor(t){this.boundary=t,this.has_sub_divisions=!1}subdivide(){const t=this.boundary.half_dimension,e=this.boundary.center,s=new C(new f(new c(e.x+t.width/2,e.y-t.height/2),this.boundary.half_dimension.scale(.5))),i=new C(new f(new c(e.x-t.width/2,e.y-t.height/2),this.boundary.half_dimension.scale(.5))),n=new C(new f(new c(e.x-t.width/2,e.y+t.height/2),this.boundary.half_dimension.scale(.5))),h=new C(new f(new c(e.x+t.width/2,e.y+t.height/2),this.boundary.half_dimension.scale(.5)));this.regions.push(s,i,n,h),this.has_sub_divisions=!0}contains(t){return this.boundary.containsPoint(t)}insert(t){if(!this.boundary.containsPoint(t.point))return!1;if(!this.node&&!this.has_sub_divisions)return this.node=t,this.COM=t.point.copy(),this.mass=t.mass,!0;this.has_sub_divisions||this.subdivide(),this.region_name="";let e=!1;for(const i of this.regions)!e&&this.node&&i.insert(this.node)&&(e=!0,this.node=void 0),this.region_name+=i.node?.id??"";let s=!1;for(const i of this.regions)if(i.insert(t)){s=!0;break}if(s){const i=this.mass+t.mass;if(!this.COM)return!0;this.COM.scale_self(this.mass).add_self(t.point.scale(t.mass)).scale_self(1/i),this.mass=i}return s}getTotalForcesOnPoint(t,e){if(this.regions.length===0)return new c(0,0);const s=new c(0,0),i=this.getNodesInCircularRange(t.point,C.FULL_ACCURACY_CIRCLE_RADIUS);for(const n of i)t.id!=n.id&&s.add_self(e(t,n));return s.add_self(this.getForceDueToRegions(t,e,i)),s}getForceDueToRegions(t,e,s=[],i=0){const n=new c(0,0),h=1-C.ACCURACY;for(const o of this.regions){if(!o.COM||o.mass===0)continue;const a=o.COM.x-t.point.x,d=o.COM.y-t.point.y;let l=a*a+d*d;if(o.boundary.half_dimension.width/Math.sqrt(l)>=h&&o.has_sub_divisions)n.add_self(o.getForceDueToRegions(t,e,s,i+1));else{if(Math.abs(a)<1e-6&&Math.abs(d)<1e-6)continue;const y=new I(o.region_name,o.COM,o.mass);n.add_self(e(t,y))}}return n}getNodesInRange(t){const e=[];if(!this.boundary.intersectsAABB(t))return e;if(!this.has_sub_divisions)return this.node&&t.containsPoint(this.node.point)&&e.push(this.node),e;for(const s of this.regions)e.push(...s.getNodesInRange(t));return e}getNodesInCircularRange(t,e){const s=[];if(!q(t,e,this.boundary))return s;if(!this.has_sub_divisions)return this.node&&$(t,e,this.node.point)&&s.push(this.node),s;for(const i of this.regions)s.push(...i.getNodesInCircularRange(t,e));return s}*getAllRegions(){if(yield this,this.has_sub_divisions)for(const t of this.regions)yield*t.getAllRegions()}toString(){}}class E extends z{static alphaDecay=.0016;mass;quad_tree_node;attr_force=new c(0);repln_force=new c(0);alpha=1;position_change=new c(0,0);text;velocity=new c(0);radius;force=new c(0);max_velocity=100;velocity_decay=.5;min_velocity=1;constructor(t,e,s,i,n=""){super(t,e,"node"),this.pos.set(s.x,s.y),this.text=n,this.radius=i,this.mass=1,this.quad_tree_node=new I(e,this.pos,100)}update(t){t=20,super.update(t);const e=t/1e3;this.force.x=this.attr_force.x+this.repln_force.x,this.force.y=this.attr_force.y+this.repln_force.y,this.force.scale_self(this.alpha);let s=u.clamp(this.force.x*e,-this.max_velocity,this.max_velocity),i=u.clamp(this.force.y*e,-this.max_velocity,this.max_velocity);this.velocity.x+=s,this.velocity.y+=i,this.velocity.scale_self(1-this.velocity_decay),Math.abs(this.velocity.x)<this.min_velocity&&(this.velocity.x=0),Math.abs(this.velocity.y)<this.min_velocity&&(this.velocity.y=0);const n=this.velocity.x*e,h=this.velocity.y*e;this.pos.x+=n,this.pos.y+=h,this.position_change.set(n,h),this.alpha-=this.alpha*E.alphaDecay,this.alpha<.001&&(this.alpha=0),this.repln_force.set(0,0),this.attr_force.set(0,0)}render(){this.drawCircle(this.radius,this.pos.x,this.pos.y,this.color.hex,!0,N.getBgColor(this.getName(),v.BORDER).hex,1),this.drawText(this.id,this.pos.x,this.pos.y,N.getTextColor(v.ON_PRIMARY).hex)}getDistanceFromPoint(t){const e=this.pos.subtract(t).length_sqrd();return Math.sqrt(e)}containsPoint(t,e){const s=this.pos,n=new c(t,e).sub_self(s).length_sqrd();return this.radius**2>n}}class x extends z{static thickness=3;start_node;end_node;constructor(t,e,s){super(t,x.getEdgeKey(e.id,s.id),"edge"),this.start_node=e,this.end_node=s}static getEdgeKey(t,e){return[t,e].sort().join()}render(){this.drawLine(this.start_node.pos.x,this.start_node.pos.y,this.end_node.pos.x,this.end_node.pos.y,x.thickness,this.color.hex)}}const P=!1;class Y{location=new c;buttonsPressed=new Set;touches=[];isTouching=!1;element;constructor(t){this.element=t,window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchstart",this.onTouchStart,{passive:P}),window.addEventListener("touchmove",this.onTouchMove,{passive:P}),window.addEventListener("touchend",this.onTouchEnd),window.addEventListener("touchcancel",this.onTouchEnd)}onMouseMove=t=>{const e=this.element.getBoundingClientRect();this.location=new c(t.clientX-e.x,t.clientY-e.y)};onMouseDown=t=>{t.target===this.element&&this.buttonsPressed.add(t.button)};onMouseUp=t=>{this.buttonsPressed.delete(t.button)};onTouchStart=t=>{if(t.target!==this.element)return;const e=this.element.getBoundingClientRect();this.isTouching=!0,this.touches=Array.from(t.touches).map(s=>new c(s.clientX-e.x,s.clientY-e.y)),this.location=this.touches[0]};onTouchMove=t=>{const e=this.element.getBoundingClientRect();this.touches=Array.from(t.touches).map(s=>new c(s.clientX-e.x,s.clientY-e.y)),this.location=this.touches[0]};onTouchEnd=t=>{const e=this.element.getBoundingClientRect();this.touches=Array.from(t.touches).map(s=>new c(s.clientX-e.x,s.clientY-e.y)),this.isTouching=this.touches.length>0,this.touches.length>0&&(this.location=this.touches[0])};isButtonDown(t){return this.buttonsPressed.has(t)}dispose(){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),window.removeEventListener("touchcancel",this.onTouchEnd)}}const U=Object.freeze({x:0,y:0});class H{constructor(t,e){this.func=t,this.wait_ms=e,this.lastCall=-e}lastCall=0;call(...t){const e=Date.now();e-this.lastCall>=this.wait_ms&&(this.lastCall=e,this.func(...t))}}class X{camera_updated=!0;onupdate=null;constructor(){}_x=0;get x(){return this._x}set x(t){this._x=t,this.camera_updated=!0,this.onupdate&&this.onupdate()}_y=0;get y(){return this._y}set y(t){this._y=t,this.camera_updated=!0,this.onupdate&&this.onupdate()}_zoom=1;get zoom(){return this._zoom}set zoom(t){this._zoom=t,this.camera_updated=!0,this.onupdate&&this.onupdate()}}class p{constructor(t,e=!1){this.ctx=t,this.show_fps=e,this.ctx.scale(devicePixelRatio,devicePixelRatio),this.show_fps=e,this.is_running=!1,this.mouse_info=new Y(this.ctx.canvas),this.camera.onupdate=()=>{this.updateViewportFromScreen(this.ctx.canvas.width,this.ctx.canvas.height)},this.debounceSelectedNodeAlphaReset=new H((...i)=>{for(const n of i){if(!n||!this.force_quad_tree)return;n.alpha<.5&&(n.alpha=.5);for(const h of this.force_quad_tree.getNodesInCircularRange(n.pos,300)){const o=this.nodes.get(h.id);o&&o.alpha<.5&&(o.alpha=.6)}}},100),new ResizeObserver(()=>{this.updateViewportFromScreen(this.ctx.canvas.width,this.ctx.canvas.height)}).observe(this.ctx.canvas),this.ctx.canvas.addEventListener("mousedown",i=>this.handleMousePressed(i)),this.ctx.canvas.addEventListener("touchstart",i=>{this.initial_touches=i.touches,i.touches.length===1?this.handleMousePressed(i):(i.preventDefault(),this.handleMultiTouch(i))},{passive:!1}),this.ctx.canvas.addEventListener("wheel",i=>{i.shiftKey&&this.zoomAt(i.clientX*devicePixelRatio,i.clientY*devicePixelRatio,i.deltaY<0)},{passive:!1}),window.addEventListener("mouseup",()=>this.handleMouseUp()),window.addEventListener("touchend",()=>{this.handleMouseUp(),this.pinching_to_zoom=!1}),window.addEventListener("mousemove",i=>this.handleMouseMove(i),{passive:!1}),window.addEventListener("touchmove",i=>{i.touches.length===1?this.handleMouseMove(i):this.handleMultiTouchMove(i)},{passive:!1})}static ZOOM_DELTA=.3;static MIN_ZOOM=.1;static MAX_ZOOM=10;animator=new B;camera=new X;target_frame_rate=60;nodes=new Map;edges=new Map;accumulated_alpha=0;accumulated_frame_time=0;accumulated_node_position_change=-1;fps=0;last_animation_call_time=0;drawable_selected=null;grid_size=new w(100,100);prev_mouse_pos=new c;is_running;force_quad_tree;fps_counter=0;boundary_bounds=f.fromRect(0,0,0,0);required_half_size=new w(0,0);offset=new c(0);debounceSelectedNodeAlphaReset;mouse_info;dragging_camera=!1;is_zooming=!1;initial_touches=null;pinching_to_zoom=!1;repaint_drawables=!1;bounds_updated=!1;last_draw_image=null;is_loop_running=!1;viewport=f.fromRect(0,0,0,0);is_debugging=!1;getTransformedPoint(t,e){return new c(t/(this.camera.zoom*devicePixelRatio)+this.camera.x,e/(this.camera.zoom*devicePixelRatio)+this.camera.y)}async loop(t){const e=this.last_animation_call_time,s=t-this.last_animation_call_time;this.last_animation_call_time=t,performance.now(),this.is_running&&(this.update(s),this.animator.step(s)),performance.now(),performance.now(),this.render(),performance.now();const i=t-e;this.accumulated_frame_time+=i,this.show_fps&&(this.accumulated_frame_time>=1e3?(this.accumulated_frame_time=0,this.fps=this.fps_counter,this.fps_counter=0):this.fps_counter+=1),requestAnimationFrame(n=>{this.loop(n)})}start(){this.is_running||(this.is_running=!0,this.last_animation_call_time=performance.now(),this.is_loop_running||this.loop(this.last_animation_call_time).then(()=>this.is_loop_running=!0))}stop(){this.render(),this.is_running=!1,this.accumulated_frame_time=0,this.fps=0,this.fps_counter=0}render(){const t=devicePixelRatio||1;if(this.ctx.setTransform(t*this.camera.zoom,0,0,t*this.camera.zoom,-this.camera.x*t*this.camera.zoom,-this.camera.y*t*this.camera.zoom),!this.camera.camera_updated&&!this.bounds_updated&&!this.repaint_drawables){if(!this.last_draw_image)this.ctx.canvas.toBlob(a=>{a&&(this.last_draw_image=new Image,this.last_draw_image.loading="eager",this.last_draw_image.src=URL.createObjectURL(a))},"image/png",1);else if(this.last_draw_image.complete){const a=this.getTransformedPoint(0,0),d=1/(this.camera.zoom*t);this.ctx.drawImage(this.last_draw_image,a.x,a.y,this.ctx.canvas.width*d,this.ctx.canvas.height*d);return}}(this.camera.camera_updated||this.bounds_updated||this.repaint_drawables)&&(this.last_draw_image=null),this.camera.camera_updated=!1,this.repaint_drawables=!1;const e=this.ctx.canvas.width,s=this.ctx.canvas.height;this.ctx.save(),this.ctx.resetTransform(),this.ctx.fillStyle=N.getBgColor("canvas").hex,this.ctx.fillRect(0,0,e,s),this.ctx.beginPath();const i=-(this.camera.x*this.camera.zoom*t%(this.grid_size.width*this.camera.zoom*t)),n=-(this.camera.y*this.camera.zoom*t%(this.grid_size.height*this.camera.zoom*t));this.ctx.strokeStyle=N.getColor("grid").hex,this.ctx.lineWidth=1;for(let a=i;a<e;a+=this.grid_size.width*this.camera.zoom*t)this.ctx.moveTo(a,0),this.ctx.lineTo(a,s);for(let a=n;a<s;a+=this.grid_size.height*this.camera.zoom*t)this.ctx.moveTo(0,a),this.ctx.lineTo(e,a);this.ctx.stroke(),this.ctx.restore(),this.ctx.save();const h=this.edges,o=this.nodes;for(const[,a]of h)!this.viewport.containsPoint(a.start_node.pos)&&!this.viewport.containsPoint(a.end_node.pos)||a.render();for(const[,a]of o)this.viewport.containsPoint(a.pos)&&a?.render();if(this.force_quad_tree&&this.is_debugging){this.ctx.beginPath(),this.ctx.setLineDash([]),this.ctx.strokeStyle=N.getColor("debug").hex;let a=null;for(const d of this.force_quad_tree.getAllRegions())a=d.boundary,this.ctx.strokeRect(a.center.x-a.half_dimension.width,a.center.y-a.half_dimension.height,a.half_dimension.width*2,a.half_dimension.height*2),d.COM&&this.ctx.fillText(`${d.mass}`,d.COM.x,d.COM.y);a=this.viewport,this.ctx.strokeStyle="#00f",this.ctx.strokeRect(a.center.x-a.half_dimension.width,a.center.y-a.half_dimension.height,a.half_dimension.width*2,a.half_dimension.height*2),this.ctx.closePath()}this.ctx.restore()}update(t){this.accumulated_alpha<.001&&(this.accumulated_alpha=0);const e=new c;let s=0;this.accumulated_alpha=0;for(const[,i]of this.nodes)this.accumulated_alpha+=i.alpha,e.add_self(i.pos.scale(i.mass)),s+=i.mass;if(e.scale_self(1/s),this.accumulated_alpha!==0||this.bounds_updated||this.camera.camera_updated){this.force_quad_tree=new C(this.boundary_bounds);for(const[,i]of this.nodes)this.force_quad_tree.insert(i.quad_tree_node);this.repaint_drawables=!0,this.bounds_updated=!1}if(this.accumulated_alpha!==0){for(const[,i]of this.edges){i.update(t);const n=i.start_node,h=i.end_node,o=V(n,h);n.attr_force.x+=o.x,n.attr_force.y+=o.y,h.attr_force.x-=o.x,h.attr_force.y-=o.y}for(const[i,n]of this.nodes)if(this.drawable_selected===n||!this.force_quad_tree.contains(n.pos)?(n.repln_force.set(0,0),n.attr_force.set(0,0)):this.force_quad_tree&&this.accumulated_alpha!==0&&(n.repln_force=this.force_quad_tree.getTotalForcesOnPoint(n.quad_tree_node,G)),n.update(t),this.accumulated_frame_time===0){const h=document.getElementById(i);h&&(h.innerHTML=`<div>id: ${n.id}</div><div>alpha: ${n.alpha}</div><div> pos: ${this.getTransformedPoint(n.pos.x,n.pos.y)} </div><div>vel: ${Math.round(n.velocity.x*1e3)/1e3}i + ${Math.round(n.velocity.y*1e3)/1e3}</div><div>force: ${Math.round(n.force.x*1e3)/1e3}i + ${Math.round(n.force.y*1e3)/1e3}</div>`)}}this.required_half_size.set(0,0);for(const[,i]of this.nodes)this.recheckQuadtreeBounds(i,e),i.position_change.x===0&&i.position_change.y===0&&i.alpha!==0&&(i.alpha=Math.max(0,i.alpha-i.alpha*.1));this.drawable_selected?(this.ctx.canvas.style.cursor="pointer",this.debounceSelectedNodeAlphaReset.call(this.drawable_selected)):this.ctx.canvas.style.cursor="default"}addNode(t,e,s){if(this.nodes.has(t))return!1;const i=new E(this,t,e,s);return this.nodes.set(t,i),this.debounceSelectedNodeAlphaReset.call(i),this.accumulated_alpha+=i.alpha,!0}handleMultiTouchMove(t){if(!this.initial_touches||!this.initial_touches[1]||!this.initial_touches[0]||!t.touches[0]||!t.touches[1]||!this.pinching_to_zoom||t.touches.length!==2)return;if(!this.initial_touches){this.initial_touches=t.touches;return}const e=(g,m)=>{const y=g.clientX-m.clientX,R=g.clientY-m.clientY;return Math.sqrt(y*y+R*R)},s=e(this.initial_touches[0],this.initial_touches[1]),i=e(t.touches[0],t.touches[1]);if(s===0)return;const n=i/s,h=u.clamp(this.camera.zoom*n,p.MIN_ZOOM,p.MAX_ZOOM),o=(t.touches[0].clientX+t.touches[1].clientX)/2*devicePixelRatio,a=(t.touches[0].clientY+t.touches[1].clientY)/2*devicePixelRatio,d=this.getTransformedPoint(o,a);this.camera.zoom=h;const l=this.getTransformedPoint(o,a);this.camera.x+=d.x-l.x,this.camera.y+=d.y-l.y,this.initial_touches=t.touches}handleMultiTouch(t){t.touches.length===2&&(this.pinching_to_zoom=!0)}handleMouseUp(){this.drawable_selected=null,this.dragging_camera=!1}zoomAt(t,e,s){const i=this.camera.zoom+p.ZOOM_DELTA*this.camera.zoom*(s?1:-1);if(i>p.MAX_ZOOM||i<p.MIN_ZOOM)return;const n=this.camera.zoom,h=this.getTransformedPoint(t,e);this.animator.add(new D((o,a)=>{this.is_zooming=!a,this.camera.x=h.x-t/(devicePixelRatio*o),this.camera.y=h.y-e/(devicePixelRatio*o),this.camera.zoom=u.clamp(o,p.MIN_ZOOM,p.MAX_ZOOM)},n,i,100,A.linear))}addEdge(t,e){const s=this.nodes.get(t),i=this.nodes.get(e);return!s||!i?!1:(this.edges.get(x.getEdgeKey(t,e))||(s.alpha=.5,i.alpha=.5,this.debounceSelectedNodeAlphaReset.call(s,i),this.edges.set(x.getEdgeKey(t,e),new x(this,s,i))),!0)}handleMouseMove(t){const e=t instanceof MouseEvent?t:t.touches[0];if(!e)return;const s=this.getTransformedPoint(e.clientX*devicePixelRatio,e.clientY*devicePixelRatio),i=s.x-this.prev_mouse_pos.x,n=s.y-this.prev_mouse_pos.y;this.drawable_selected?(this.drawable_selected.pos.x+=i,this.drawable_selected.pos.y+=n,this.drawable_selected instanceof E&&this.drawable_selected.position_change.set(i,n),this.prev_mouse_pos.set(s.x,s.y)):this.dragging_camera&&(this.camera.x-=i,this.camera.y-=n)}recheckQuadtreeBounds(t,e){if(!this.boundary_bounds.containsPoint(t.pos)){const i=t.pos.subtract(this.boundary_bounds.center),n=Math.abs(i.dot(c.unit_x))+300,h=Math.abs(i.dot(c.unit_y))+300,o=Math.max(n,this.required_half_size.width),a=Math.max(h,this.required_half_size.height);this.boundary_bounds.center.set(e.x,e.y),this.boundary_bounds.half_dimension.set(o,a),this.required_half_size.set(o,a),this.bounds_updated=!0}}updateViewportFromScreen(t,e){const i=t,n=e,h=this.getTransformedPoint(0,0),o=this.getTransformedPoint(i,n),a=o.x-h.x,d=o.y-h.y;this.viewport.updateRect(h.x-100,h.y-100,a+100,d+100),this.bounds_updated=!0}handleMousePressed(t){if(!this.nodes)return;const e=t instanceof MouseEvent?t:t.touches[0];if(!e)return;const s=this.getTransformedPoint(e.clientX*devicePixelRatio,e.clientY*devicePixelRatio);this.prev_mouse_pos.set(s.x,s.y);for(const[,i]of this.nodes)if(i.containsPoint(s.x,s.y)){this.drawable_selected=i;break}this.drawable_selected||(this.dragging_camera=!0)}removeNode(t){return this.nodes.delete(t)}highlightNode(t){const e=this.nodes.get(t);return e?(e.highlight(),!0):!1}unhighlightNode(t){return!1}moveNode(t,e,s){return!1}labelNode(t,e){return!1}removeEdge(t,e){return this.edges.delete(x.getEdgeKey(t,e))}highlightEdge(t,e){const s=this.edges.get(x.getEdgeKey(t,e));return s?(s.highlight(),!0):!1}unhighlightEdge(t,e){return!1}labelEdge(t,e,s){return!1}noop(){return!0}finished(){return!1}error(t){return!1}reset(){return!1}clear(){return this.nodes.clear(),this.edges.clear(),!0}}const F=10**2,j=0,Z=1e4,K=1e4;function G(r,t){const e=r.point.subtract(t.point),s=e.length_sqrd(),i=Math.atan2(e.y,e.x),n=Z/(s+F)*t.mass*r.mass;return new c(Math.round(n*Math.cos(i)),Math.round(n*Math.sin(i)))}function V(r,t){const s=(r.radius+t.radius+j)**2,i=r.pos.subtract(t.pos),n=i.length_sqrd();if(n<.01)return U;const h=K*(n-s);return{x:-Math.round(i.x/n*h),y:-Math.round(i.y/n*h)}}class W{constructor(t){this.id=t}async execute(t){t.highlightNode(this.id)}}class Q{constructor(t,e){this.from_id=t,this.to_id=e}async execute(t){t.highlightEdge(this.from_id,this.to_id)}}class J{async execute(t){t.finished()}}class M{constructor(t,e=!0){this.start_node=t,this.bidirectional=e,this.addNode(t)}adjacency_mapping=new Map;addNode(t){return this.adjacency_mapping.has(t)||this.adjacency_mapping.set(t,new Set),this}attach(t,e){this.addNode(t);let s=this.adjacency_mapping.get(t);for(const i of e)this.addNode(i),s?.add(i),this.bidirectional&&this.adjacency_mapping.get(i)?.add(t);return this}getNeighbors(t){return Array.from(this.adjacency_mapping.get(t)??[])}getNodes(){return Array.from(this.adjacency_mapping.keys())}toString(){let t="";for(const[e,s]of this.adjacency_mapping.entries())t+=`${e} â†’ ${[...s].join(", ")}`;return t}static simple_graph=new M("A").attach("A",["B","C","D"]).attach("B",["E","F"]);static clustered_graph=new M("Cluster1").attach("Cluster1",["C1A","C1B","C1C"]).attach("C1A",["C1B","C1C"]).attach("C1B",["C1C"]).attach("Cluster2",["C2A","C2B","C2C"]).attach("C2A",["C2B","C2C"]).attach("C2B",["C2C"]).attach("Cluster3",["C3A","C3B","C3C"]).attach("C3A",["C3B","C3C"]).attach("C3B",["C3C"]).attach("Cluster1",["Cluster2"]).attach("Cluster2",["Cluster3"]);static spider_web_graph=new M("Center").attach("Center",["N1","N2","N3","N4","N5","N6"]).attach("N1",["N2","N6"]).attach("N2",["N1","N3"]).attach("N3",["N2","N4"]).attach("N4",["N3","N5"]).attach("N5",["N4","N6"]).attach("N6",["N5","N1"]);static large_graph=new M("C1N1").attach("C1N1",["C1N2","C1N3","C1N4"]).attach("C1N2",["C1N5","C1N6"]).attach("C1N3",["C1N7","C1N8"]).attach("C1N4",["C1N9","C1N10"]).attach("C2N1",["C2N2","C2N3","C2N4"]).attach("C2N2",["C2N5","C2N6"]).attach("C2N3",["C2N7","C2N8"]).attach("C2N4",["C2N9","C2N10"]).attach("C3N1",["C3N2","C3N3","C3N4"]).attach("C3N2",["C3N5","C3N6"]).attach("C3N3",["C3N7","C3N8"]).attach("C3N4",["C3N9","C3N10"]).attach("C4N1",["C4N2","C4N3","C4N4"]).attach("C4N2",["C4N5","C4N6"]).attach("C4N3",["C4N7","C4N8"]).attach("C4N4",["C4N9","C4N10"]).attach("C5N1",["C5N2","C5N3","C5N4"]).attach("C5N2",["C5N5","C5N6"]).attach("C5N3",["C5N7","C5N8"]).attach("C5N4",["C5N9","C5N10"]).attach("C6N1",["C6N2","C6N3","C6N4"]).attach("C6N2",["C6N5","C6N6"]).attach("C6N3",["C6N7","C6N8"]).attach("C6N4",["C6N9","C6N10"]).attach("C7N1",["C7N2","C7N3","C7N4"]).attach("C7N2",["C7N5","C7N6"]).attach("C7N3",["C7N7","C7N8"]).attach("C7N4",["C7N9","C7N10"]).attach("C8N1",["C8N2","C8N3","C8N4"]).attach("C8N2",["C8N5","C8N6"]).attach("C8N3",["C8N7","C8N8"]).attach("C8N4",["C8N9","C8N10"]).attach("C9N1",["C9N2","C9N3","C9N4"]).attach("C9N2",["C9N5","C9N6"]).attach("C9N3",["C9N7","C9N8"]).attach("C9N4",["C9N9","C9N10"]).attach("C10N1",["C10N2","C10N3","C10N4"]).attach("C10N2",["C10N5","C10N6"]).attach("C10N3",["C10N7","C10N8"]).attach("C10N4",["C10N9","C10N10"]).attach("C1N1",["C2N1"]).attach("C2N1",["C3N1"]).attach("C3N1",["C4N1"]).attach("C4N1",["C5N1"]).attach("C5N1",["C6N1"]).attach("C6N1",["C7N1"]).attach("C7N1",["C8N1"]).attach("C8N1",["C9N1"]).attach("C9N1",["C10N1"])}function*tt(r,t){const e=[],s=[[null,t]];for(;s.length>0;){const i=s.pop(),n=i[0],h=i[1];if(!e.includes(h)){yield new Q(n,h),yield new W(h),e.push(h);for(const o of r.getNeighbors(h))e.includes(o)||s.push([h,o])}}return new J}const et=globalThis.setInterval,T=20;function st(r,t,e=T){const s=t.ctx.canvas.getBoundingClientRect();let i=s.width/2,n=s.height/2,h=0,o=0,a=0,d=1,l=0,g=0,m=0;for(const y of r.getNodes()){let R=h*Math.cos(m)-o*Math.sin(m)+i,L=h*Math.sin(m)+o*Math.cos(m)+n;t.addNode(y,new c(R,L),T),l++,m+=g,l===d&&(a++,h=2*e*a,m=0,l=0,g=Math.acos(1-1/(2*a*a)),d=Math.round(2*Math.PI/g))}}class nt{step_time_ms;scene;algorithm_name;algorithm_instance;playing;generator;finished=!1;constructor(t,e){this.scene=t,this.step_time_ms=200,this.scene.start(),this.algorithm_name=e,this.generator=null,this.playing=!0}load(t){this.scene.clear();const e=new Set,s=document.getElementById("debug-data");s?s.textContent="":console.error("Debugging panel not found"),st(t,this.scene);for(const h of t.getNodes()){if(s){const o=document.createElement("div");o.id=h.toString(),o.classList.add("node"),s.append(o)}for(const o of t.getNeighbors(h))this.scene.addEdge(h,o),e.add(o);e.add(h)}const i=tt(t,t.start_node),n=et(()=>{const h=i.next();if(h.done){clearInterval(n);return}h.value.execute(this.scene)},this.step_time_ms)}stop(){}reset(){}start(){}}export{v as ColorStates,M as Graph,j as NATURAL_EDGE_LENGTH,p as Scene,N as ThemeManager,S as ThemeType,nt as Visualizer,V as computeAttraction,G as computeRepulsion,K as k_attr,Z as k_repl};
